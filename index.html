<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project Blue Tucson Data Center Campus Impact Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #334155;
            --bg-hover: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --accent-water: #06b6d4;
            --accent-electric: #f59e0b;
            --accent-economy: #10b981;
            --accent-cost: #8b5cf6;
            --positive: #22c55e;
            --negative: #ef4444;
            --warning: #f97316;
            --danger: #ff6b6b;
            --developer-claim: #3b82f6;
            --comparison-marker: #64748b;
            --border: #475569;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.2);
            --shadow-md: 0 4px 24px rgba(0,0,0,0.3);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.4);
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Loading animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--bg-secondary);
            border-top-color: var(--accent-water);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
            animation-delay: 0.3s;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .attribution {
            text-align: center;
            margin-bottom: 24px;
            font-size: 22px;
            font-weight: 800;
            color: var(--text-primary);
            transform: translateY(-10px);
            opacity: 0;
            animation: slideDown 0.5s ease forwards;
            animation-delay: 0.4s;
        }

        @keyframes slideDown {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .attribution a {
            color: var(--accent-water);
            text-decoration: none;
            position: relative;
            transition: color var(--transition-fast);
        }

        .attribution a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent-water);
            transition: width var(--transition-normal);
        }

        .attribution a:hover {
            color: #38bdf8;
        }

        .attribution a:hover::after {
            width: 100%;
        }

        header {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.6s ease forwards;
            animation-delay: 0.5s;
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        h1 {
            font-size: clamp(28px, 4vw, 36px);
            font-weight: 800;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-water));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: help;
            transition: transform var(--transition-fast);
        }

        h1:hover {
            transform: translateX(2px);
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .summary {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            font-size: 14px;
            line-height: 1.8;
            color: var(--text-secondary);
            position: relative;
            overflow: hidden;
        }

        .summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-water);
            opacity: 0.5;
        }

        .info-button {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 12px;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .info-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--bg-hover);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .info-button:hover::before {
            width: 150%;
            height: 150%;
        }

        .info-button:hover {
            color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .info-button span {
            position: relative;
            z-index: 1;
        }

        .sticky-share {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-primary);
            padding: 24px 0;
            margin-bottom: 32px;
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(10px);
            background: rgba(15, 23, 42, 0.95);
        }

        .share-row {
            display: flex;
            gap: 24px;
            align-items: center;
            justify-content: space-around;
        }

        .share-metric {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            transition: all var(--transition-normal);
            cursor: help;
        }

        .share-metric:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--bg-hover);
        }

        .share-metric-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            line-height: 1.2;
        }

        .share-metric-value {
            font-size: clamp(20px, 3vw, 28px);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            transition: transform var(--transition-fast);
        }

        .share-metric:hover .share-metric-value {
            transform: scale(1.05);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .slider-section {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: all var(--transition-normal);
            opacity: 0;
            transform: translateY(20px);
            animation: slideUp 0.6s ease forwards;
        }

        .slider-section:nth-child(1) { animation-delay: 0.6s; }
        .slider-section:nth-child(2) { animation-delay: 0.7s; }
        .slider-section:nth-child(3) { animation-delay: 0.8s; }
        .slider-section:nth-child(4) { animation-delay: 0.9s; }

        .slider-section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .slider-section.full-width {
            grid-column: 1 / -1;
        }

        .slider-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .slider-title {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: help;
            transition: transform var(--transition-fast);
        }

        .slider-title:hover {
            transform: translateX(2px);
        }

        .slider-title h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .icon {
            font-size: 28px;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .consumption-badge {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: clamp(14px, 2vw, 16px);
            font-weight: 700;
            transition: all var(--transition-normal);
            cursor: help;
            text-align: center;
            min-width: 200px;
            position: relative;
            overflow: hidden;
        }

        .consumption-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s;
        }

        .consumption-badge:hover::before {
            left: 100%;
        }

        .consumption-low {
            background: rgba(34, 197, 94, 0.2);
            color: var(--positive);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .consumption-medium {
            background: rgba(249, 115, 22, 0.2);
            color: var(--warning);
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .consumption-high {
            background: rgba(239, 68, 68, 0.2);
            color: var(--negative);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .slider-container {
            position: relative;
            margin: 40px 0 60px;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .comparison-markers {
            position: absolute;
            bottom: -50px;
            left: 0;
            right: 0;
            height: 45px;
            z-index: 5;
        }

        .marker {
            position: absolute;
            transform: translateX(-50%);
            text-align: center;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            z-index: 5;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            top: 15px;
        }

        .marker:hover {
            transform: translateX(-50%) translateY(-2px);
            z-index: 10;
        }

        .marker-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--comparison-marker);
            transition: all var(--transition-fast);
            order: -1;
            position: relative;
        }

        .marker-dot::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            border-radius: 50%;
            background: inherit;
            opacity: 0.3;
            transition: all var(--transition-normal);
        }

        .marker:hover .marker-dot::after {
            width: 20px;
            height: 20px;
        }

        .marker.developer .marker-dot {
            background: var(--developer-claim);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .marker-label {
            white-space: nowrap;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            max-width: 90px;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all var(--transition-fast);
        }

        .marker:hover .marker-label {
            max-width: none;
            z-index: 10;
            box-shadow: var(--shadow-sm);
        }

        .marker.developer .marker-label {
            color: var(--developer-claim);
            font-weight: 700;
            border-color: var(--developer-claim);
            max-width: none;
            white-space: normal;
            line-height: 1.2;
            text-align: center;
            width: 60px;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--bg-card);
            outline: none;
            cursor: pointer;
            position: relative;
            transition: background var(--transition-fast);
        }

        .slider:hover {
            background: var(--bg-hover);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--text-primary);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
            position: relative;
            z-index: 20;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        .slider::-webkit-slider-thumb:active {
            transform: scale(0.95);
        }

        .slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--text-primary);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
            border: none;
            position: relative;
            z-index: 20;
        }

        .slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        .slider::-moz-range-thumb:active {
            transform: scale(0.95);
        }

        /* Touch-friendly mobile adjustments */
        @media (hover: none) {
            .slider::-webkit-slider-thumb {
                width: 36px;
                height: 36px;
            }
           
            .slider::-moz-range-thumb {
                width: 36px;
                height: 36px;
            }
        }

        .slider-value {
            margin-top: 20px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all var(--transition-normal);
        }

        .slider-value:hover {
            border-color: var(--bg-hover);
            box-shadow: var(--shadow-sm);
        }

        .value-main {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .value-details {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .hoverable {
            cursor: help;
            position: relative;
            border-bottom: 1px dotted var(--text-muted);
        }

        .tooltip {
            position: fixed;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity var(--transition-fast);
            z-index: 1000;
            max-width: 350px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            line-height: 1.6;
            transform: scale(0.95);
        }

        .tooltip.show {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }

        .tooltip a {
            color: var(--accent-water);
            text-decoration: none;
        }

        .tooltip a:hover {
            text-decoration: underline;
        }

        .tooltip code {
            background: var(--bg-card);
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 12px;
        }

        .impact-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .impact-summary {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            opacity: 0;
            transform: translateY(20px);
            animation: slideUp 0.6s ease forwards;
            animation-delay: 1s;
        }

        .impact-summary h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
            cursor: help;
        }

        .impact-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
            animation-delay: 1.1s;
        }

        .impact-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .impact-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: help;
        }

        .cost-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 14px;
            transition: all var(--transition-fast);
        }

        .cost-line:hover {
            transform: translateX(2px);
        }

        .cost-label {
            color: var(--text-secondary);
            cursor: help;
            transition: color var(--transition-fast);
        }

        .cost-line:hover .cost-label {
            color: var(--text-primary);
        }

        .cost-value {
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            cursor: help;
            transition: transform var(--transition-fast);
        }

        .cost-line:hover .cost-value {
            transform: scale(1.05);
        }

        .cost-value.negative {
            color: var(--negative);
        }

        .cost-value.positive {
            color: var(--positive);
        }

        .cost-value.neutral {
            color: var(--text-muted);
        }

        .share-visualization {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            opacity: 0;
            transform: translateY(20px);
            animation: slideUp 0.6s ease forwards;
            animation-delay: 1.1s;
        }

        .share-visualization h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--text-primary);
            cursor: help;
        }

        .share-item {
            margin-bottom: 30px;
            position: relative;
        }

        .share-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .share-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: help;
        }

        .share-percent {
            font-size: 20px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            cursor: help;
            transition: transform var(--transition-fast);
        }

        .share-item:hover .share-percent {
            transform: scale(1.1);
        }

        .share-bar-container {
            width: 100%;
            height: 24px;
            background: var(--bg-primary);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .share-bar-container::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
            opacity: 0.5;
            pointer-events: none;
        }

        .share-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            min-width: 2px;
            transition: width var(--transition-slow);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .share-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .share-fill.water {
            background: linear-gradient(90deg, var(--accent-water), #06b6d4aa);
        }

        .share-fill.electric {
            background: linear-gradient(90deg, var(--accent-electric), #f59e0baa);
        }

        .share-fill.economy {
            background: linear-gradient(90deg, var(--accent-economy), #10b981aa);
        }

        .net-impact {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            grid-column: 1 / -1;
            opacity: 0;
            transform: translateY(20px);
            animation: slideUp 0.6s ease forwards;
            animation-delay: 1.2s;
        }

        .net-impact::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .net-impact-content {
            position: relative;
            z-index: 1;
        }

        .net-impact h3 {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 16px;
            cursor: help;
        }

        .net-annual {
            font-size: clamp(36px, 6vw, 48px);
            font-weight: 800;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
            cursor: help;
            transition: transform var(--transition-fast);
        }

        .net-annual:hover {
            transform: scale(1.05);
        }

        .net-annual.positive {
            color: var(--positive);
            text-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }

        .net-annual.negative {
            color: var(--negative);
            text-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        }

        .net-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .construction-section {
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .construction-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-economy);
            font-family: 'JetBrains Mono', monospace;
            cursor: help;
            transition: transform var(--transition-fast);
        }

        .construction-value:hover {
            transform: scale(1.05);
        }

        .construction-note {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 4px;
            cursor: help;
        }

        .methodology-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            padding: 40px;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }

        .methodology-content {
            max-width: 800px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .methodology-content h2 {
            font-size: 24px;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        .methodology-content h3 {
            font-size: 18px;
            margin: 24px 0 12px;
            color: var(--text-primary);
        }

        .methodology-content p {
            margin-bottom: 16px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .methodology-content ul {
            margin-bottom: 16px;
            padding-left: 24px;
            color: var(--text-secondary);
        }

        .methodology-content li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .methodology-content code {
            background: var(--bg-card);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
        }

        .methodology-content a {
            color: #60a5fa;
            text-decoration: underline;
            transition: color var(--transition-fast);
        }

        .methodology-content a:hover {
            color: var(--text-primary);
            text-decoration: none;
        }

        .close-button {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 16px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            margin-top: 24px;
            transition: all var(--transition-fast);
        }

        .close-button:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        footer {
            text-align: center;
            padding: 32px;
            color: var(--text-muted);
            font-size: 13px;
            border-top: 1px solid var(--border);
            margin-top: 48px;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
            animation-delay: 1.3s;
        }

        footer a {
            color: var(--accent-water);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        footer a:hover {
            text-decoration: underline;
            color: #38bdf8;
        }

        /* Enhanced mobile styles */
        @media (max-width: 1024px) {
            .main-grid,
            .impact-grid {
                grid-template-columns: 1fr;
            }
           
            .net-annual {
                font-size: 36px;
            }

            .share-percent {
                font-size: 18px;
            }

            .marker-label {
                font-size: 10px;
                padding: 1px 4px;
            }

            .share-row {
                flex-direction: column;
                gap: 16px;
            }

            .share-metric {
                width: 100%;
            }
        }

        @media (max-width: 640px) {
            h1 {
                font-size: 24px;
            }
           
            .container {
                padding: 16px;
            }
           
            .slider-section,
            .impact-summary,
            .share-visualization,
            header {
                padding: 20px;
            }

            .marker {
                font-size: 9px;
            }

            .marker-label {
                max-width: 60px;
            }

            .marker-dot {
                width: 6px;
                height: 6px;
            }

            .share-metric-value {
                font-size: 20px;
            }

            .consumption-badge {
                min-width: 150px;
                font-size: 12px;
            }

            .slider::-webkit-slider-thumb {
                width: 32px;
                height: 32px;
            }
           
            .slider::-moz-range-thumb {
                width: 32px;
                height: 32px;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --border: #64748b;
                --text-muted: #cbd5e1;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus styles for accessibility */
        *:focus-visible {
            outline: 2px solid var(--accent-water);
            outline-offset: 2px;
        }

        button:focus-visible,
        .slider:focus-visible {
            outline: 2px solid var(--accent-water);
            outline-offset: 4px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/iframe-resizer@5.4.6/js/iframeResizer.contentWindow.min.js"></script>
</head>
<body>
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <div class="attribution">
            <strong>Analysis by <a href="https://www.skyislandai.com/" target="_blank">Sky Island AI</a> - Based in Tucson, Arizona</strong>
        </div>

        <header>
            <h1 data-tooltip="This dashboard calculates the true financial impact of Project Blue on Tucson taxpayers and ratepayers using economic modeling techniques">Project Blue Tucson Data Center Campus Impact Dashboard</h1>
            <div class="subtitle">
                <span>Economic impact calculator based on Net Local Impact methodology</span>
                <button class="info-button" onclick="showMethodology()"><span>‚ìò Methodology & Sources</span></button>
            </div>
            <div class="summary">
                Project Blue is a large-scale data center campus proposed by developer Beale Infrastructure for a 290-acre site in the Tucson area, intended for an undisclosed major technology client. The project plans to invest billions in construction and equipment, creating temporary construction jobs and permanent operational jobs, while also funding an 18-mile extension of the reclaimed water system. However, the proposal has drawn significant criticism from local officials and residents over the lack of transparency and the potential strain on local water and energy resources in a desert community.
            </div>
        </header>

        <div class="sticky-share">
            <h3 style="text-align: center; margin-bottom: 8px; font-size: 18px; font-weight: 700; color: var(--text-primary);">Share of Local Resources & Economy</h3>
            <p style="text-align: center; margin-bottom: 16px; font-size: 16px; color: var(--text-secondary);"><strong style="color: var(--accent-water);">Adjust sliders below to update</strong></p>
            <div class="share-row">
                <div class="share-metric">
                    <div class="share-metric-label">Water Supply</div>
                    <div class="share-metric-value" id="sticky-water" style="color: var(--accent-water);">0.00%</div>
                </div>
                <div class="share-metric">
                    <div class="share-metric-label">Electric Supply</div>
                    <div class="share-metric-value" id="sticky-electric" style="color: var(--accent-electric);">0.00%</div>
                </div>
                <div class="share-metric">
                    <div class="share-metric-label">Annual Ongoing Economic Activity</div>
                    <div class="share-metric-value" id="sticky-economy" style="color: var(--accent-economy);">0.00%</div>
                </div>
            </div>
        </div>

        <div style="background: var(--bg-card); border-radius: 12px; padding: 20px; margin: 24px 0; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
            <p style="font-size: 14px; color: var(--text-secondary); line-height: 1.6; margin: 0; text-align: center;">
                <strong style="color: var(--text-primary);">Many details about Project Blue are unknown.</strong> <strong style="color: var(--accent-water);">Drag the sliders below</strong> to see how different possibilities could change the ultimate impact on Tucson's resources and economy. Click on the labeled reference points for some of the possibilities based on Project Blue's claims and other industry data.
            </p>
        </div>

        <div class="main-grid">
            <!-- Water Use Section -->
            <div class="slider-section">
                <div class="slider-header">
                    <div class="slider-title" data-tooltip="Potable water consumption for cooling servers in Million Gallons per Day (MGD). Data centers require significant water for evaporative cooling in hot climates like Tucson">
                        <span class="icon">üíß</span>
                        <h2>WATER USE (MGD)</h2>
                    </div>
                    <div class="consumption-badge" id="water-badge" data-tooltip="Percentage of Tucson's potable water delivery (78.6 MGD in 2024)">0% of Tucson Potable Water</div>
                </div>
               
                <p style="font-size: 13px; color: var(--text-secondary); line-height: 1.6; margin: 16px 0;">
                    Project Blue will use potable water, claiming an eventual transition to "100% renewable water resources, primarily reclaimed water" via a new 18-mile pipeline on an undisclosed timeline.
                </p>
               
                <div class="slider-container">
                    <input type="range" class="slider" id="water-slider" min="-0.1" max="5" step="0.1" value="1.0">
                    <div class="comparison-markers" id="water-markers"></div>
                </div>
                <div class="slider-value" id="water-value"></div>
            </div>

            <!-- Electric Use Section -->
            <div class="slider-section">
                <div class="slider-header">
                    <div class="slider-title" data-tooltip="Continuous power draw. Data centers run 24/7/365 at high capacity factors (90%+)">
                        <span class="icon">‚ö°</span>
                        <h2>ELECTRIC USE</h2>
                    </div>
                    <div class="consumption-badge" id="electric-badge" data-tooltip="Percentage of TEP's total annual generation (9.21 TWh)">0% of TEP Supply</div>
                </div>
                <div class="slider-container">
                    <input type="range" class="slider" id="electric-slider" min="50" max="500" step="5" value="228">
                    <div class="comparison-markers" id="electric-markers"></div>
                </div>
                <div class="slider-value" id="electric-value"></div>
            </div>

            <!-- Project Scale Section -->
            <div class="slider-section">
                <div class="slider-header">
                    <div class="slider-title" data-tooltip="Total project spending broken into construction and equipment categories">
                        <span class="icon">üèóÔ∏è</span>
                        <h2>PROJECT SCALE</h2>
                    </div>
                </div>
               
                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 14px; margin-bottom: 12px; color: var(--text-secondary);" data-tooltip="Building construction, site work, infrastructure. Local capture rate ~48.9%">Construction Investment</h3>
                    <div class="slider-container">
                        <input type="range" class="slider" id="construction-slider" min="1000" max="2500" step="50" value="1200">
                        <div class="comparison-markers" id="construction-markers"></div>
                    </div>
                    <div class="slider-value" id="construction-value"></div>
                </div>

                <div>
                    <h3 style="font-size: 14px; margin-bottom: 12px; color: var(--text-secondary);" data-tooltip="Servers and cooling equipment purchased from outside Tucson. Minimal local economic benefit (~5% capture) but gets 8.7% tax exemption that reduces annual revenue">Equipment Investment</h3>
                    <div class="slider-container">
                        <input type="range" class="slider" id="equipment-slider" min="500" max="2500" step="50" value="2400">
                        <div class="comparison-markers" id="equipment-markers"></div>
                    </div>
                    <div class="slider-value" id="equipment-value"></div>
                </div>
            </div>

            <!-- Economic Activity Section -->
            <div class="slider-section">
                <div class="slider-header">
                    <div class="slider-title" data-tooltip="Ongoing local economic activity from operations">
                        <span class="icon">üí∞</span>
                        <h2>LOCAL ECONOMIC ACTIVITY</h2>
                    </div>
                </div>
               
                <div>
                    <h3 style="font-size: 14px; margin-bottom: 12px; color: var(--text-secondary);" data-tooltip="Direct payroll plus local procurement. Formula: Jobs √ó Avg Salary + Local Services. Economic multiplier: 1.4x at minimum spending, 2.4x at maximum">Annual Local Spending</h3>
                    <div class="slider-container">
                        <input type="range" class="slider" id="economic-slider" min="40" max="120" step="5" value="60">
                        <div class="comparison-markers" id="economic-markers"></div>
                    </div>
                    <div class="slider-value" id="economic-value"></div>
                </div>

                <div style="margin-top: 24px;">
                    <h3 style="font-size: 14px; margin-bottom: 40px; color: var(--text-secondary);" data-tooltip="Industrial rate paid to TEP. Currently ~$100/MWh for large users">Electric Rate ($/MWh)</h3>
                    <div class="slider-container">
                        <input type="range" class="slider" id="electric-rate-slider" min="80" max="140" step="1" value="100">
                        <div class="comparison-markers" id="electric-rate-markers" style="z-index: 5;"></div>
                    </div>
                    <div style="text-align: center; font-size: 16px; font-weight: 600; margin-top: -40px;" id="electric-rate-value">$100</div>
                </div>

                <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                    <h3 style="font-size: 14px; margin-bottom: 40px; color: var(--text-secondary);" data-tooltip="True cost to build new generation capacity. Formula varies by scenario - hover over markers for details. Excludes transmission and permitting costs">Marginal Cost of Power ($/MWh)</h3>
                    <div class="slider-container">
                        <input type="range" class="slider" id="marginal-cost-slider" min="140" max="250" step="1" value="180">
                        <div class="comparison-markers" id="marginal-cost-markers" style="z-index: 5;"></div>
                    </div>
                    <div style="text-align: center; font-size: 16px; font-weight: 600; margin-top: -40px;" id="marginal-cost-value">$180</div>
                </div>
            </div>
        </div>

        <div class="impact-grid">
            <div class="impact-summary">
                <h3 data-tooltip="Detailed breakdown of financial flows between Project Blue and the community">NET LOCAL IMPACT ANALYSIS</h3>
               
                <div class="impact-section">
                    <h4 data-tooltip="Formula: (Tax Revenue) - (Ratepayer Cost)">Electric Impact (Annual)</h4>
                    <div class="cost-line">
                        <span class="cost-label" data-tooltip="8.7% combined TPT on all electric revenue">Total Tax Revenue from Electric</span>
                        <span class="cost-value positive" id="electric-tax" data-tooltip="Revenue to state, county, and city">+$0</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-label" data-tooltip="Formula: (Marginal Cost - Rate Paid) √ó Annual Usage. When new power plants cost more than data centers pay, the difference gets added to everyone's electric bills">Cost Passed to All TEP Customers</span>
                        <span class="cost-value negative" id="electric-subsidy" data-tooltip="This amount will be recovered through future rate increases affecting all residential and business customers">-$0</span>
                    </div>
                    <div class="cost-line" style="font-weight: 600; margin-top: 8px;">
                        <span class="cost-label">Net Electric Impact</span>
                        <span class="cost-value" id="net-electric">$0</span>
                    </div>
                </div>

                <div class="impact-section">
                    <h4 data-tooltip="Formula: (Tax Revenue) - (Economic Value - Market Price) √ó Volume">Water Impact (Annual)</h4>
                    <div class="cost-line">
                        <span class="cost-label" data-tooltip="2.6% city TPT on water bills">Taxes on Water Bill</span>
                        <span class="cost-value positive" id="water-tax" data-tooltip="Revenue to City of Tucson only">+$0</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-label" data-tooltip="Formula: (Economic Value - Utility Rate) √ó Volume. Economic value includes cost of new supply, opportunity cost of other uses, and drought resilience value">Water's True Economic Cost</span>
                        <span class="cost-value negative" id="water-resource" data-tooltip="Difference between full economic value and what is actually paid">-$0</span>
                    </div>
                    <div class="cost-line" style="font-weight: 600; margin-top: 8px;">
                        <span class="cost-label">Net Water Impact</span>
                        <span class="cost-value" id="net-water">$0</span>
                    </div>
                </div>

                <div class="impact-section">
                    <h4 data-tooltip="Tax revenues vs. tax exemptions">Fiscal Impact</h4>
                    <div class="cost-line">
                        <span class="cost-label" data-tooltip="8.7% sales tax exemption on all equipment purchases, spread over 20 years (assumes LEED certification for sustainable redevelopment). This is lost revenue that other taxpayers must make up">Equipment Tax Break Cost</span>
                        <span class="cost-value negative" id="tax-abatement" data-tooltip="Annual cost to public budgets">-$0M/yr</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-label" data-tooltip="Property tax (0.79%) + other local taxes">Other Tax Revenue</span>
                        <span class="cost-value positive" id="other-taxes" data-tooltip="Ongoing tax contributions">+$0M/yr</span>
                    </div>
                </div>
            </div>

            <div class="share-visualization">
                <h3 data-tooltip="Project Blue's resource consumption and economic activity as percentage of Tucson totals">SHARE OF LOCAL RESOURCES & ECONOMY</h3>
                <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px; text-align: center;">
                    Scale: Bars are scaled 2:1 (full bar = 50% of resource)
                </p>
               
                <div class="share-item">
                    <div class="share-header">
                        <span class="share-label" data-tooltip="Percentage of Tucson Water's total supply">Water Supply</span>
                        <span class="share-percent" id="share-water-percent" style="color: var(--accent-water);">0.00%</span>
                    </div>
                    <div class="share-bar-container">
                        <div class="share-fill water" id="share-water-bar"></div>
                        <div style="position: absolute; left: 50%; top: -18px; transform: translateX(-50%); font-size: 10px; color: var(--text-muted);">25%</div>
                    </div>
                </div>

                <div class="share-item">
                    <div class="share-header">
                        <span class="share-label" data-tooltip="Percentage of TEP's total generation">Electric Supply</span>
                        <span class="share-percent" id="share-electric-percent" style="color: var(--accent-electric);">0.00%</span>
                    </div>
                    <div class="share-bar-container">
                        <div class="share-fill electric" id="share-electric-bar"></div>
                        <div style="position: absolute; left: 50%; top: -18px; transform: translateX(-50%); font-size: 10px; color: var(--text-muted);">25%</div>
                    </div>
                </div>

                <div class="share-item">
                    <div class="share-header">
                        <span class="share-label" data-tooltip="Annual ongoing economic activity as share of Tucson GDP ($62.2B)">Annual Ongoing Economic Activity</span>
                        <span class="share-percent" id="share-economy-percent" style="color: var(--accent-economy);">0.000%</span>
                    </div>
                    <div class="share-bar-container">
                        <div class="share-fill economy" id="share-economy-bar"></div>
                <div style="position: absolute; left: 50%; top: -18px; transform: translateX(-50%); font-size: 10px; color: var(--text-muted);">25%</div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <p style="font-size: 13px; color: var(--text-muted); text-align: center; cursor: help;" data-tooltip="This shows the relative scale of Project Blue's resource consumption compared to the community's total capacity">
                        For every $1,000 of Tucson's economy, Project Blue represents <span id="economy-fraction" style="font-weight: 600;">$0.00</span>
                    </p>
                </div>
            </div>
        </div>

        <div class="impact-grid">
            <div class="net-impact">
                <div class="net-impact-content">
                    <h3 data-tooltip="Sum of all impacts: Electric + Water + Fiscal">NET LOCAL IMPACT</h3>
                    <div class="net-annual" id="net-annual" data-tooltip="Annual impact on community finances">$0</div>
                    <div class="net-subtitle">per year (ongoing)</div>
                   
                    <div class="construction-section">
                        <h3 style="font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-secondary); margin-bottom: 16px; cursor: help;" data-tooltip="Construction spending √ó 48.9% local capture rate">Construction Period Benefit</h3>
                        <div class="construction-value" id="construction-total" data-tooltip="One-time economic stimulus">$0M</div>
                        <div class="construction-note" id="construction-gdp" data-tooltip="Spread over 3 years of construction">0.00% of economy</div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            Analysis by <a href="https://www.skyislandai.com/" target="_blank" style="font-size: 16px; font-weight: 600; color: #06b6d4;">Sky Island AI</a> ‚Ä¢
            <a href="#" onclick="showMethodology(); return false;">Methodology & Data Sources</a> ‚Ä¢
            Updated December 2024
        </footer>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <div class="methodology-modal" id="methodology-modal">
        <div class="methodology-content">
            <h2>Methodology & Key Sources</h2>
           
            <h3>Core Formula</h3>
            <p>This dashboard calculates the Net Local Impact (NLI) of Project Blue on the Tucson community using the formula:</p>
            <p><code>NLI = Net Fiscal Impact + Net Utility Impact (Electric + Water)</code></p>
           
            <h3>Electric Impact Model</h3>
            <p>The electric impact compares what the facility pays for power versus the true marginal cost of providing that power:</p>
            <p><code>Net Electric = Total Tax Revenue - Ratepayer Cost Passthrough</code></p>
            <p>Where Total Tax Revenue includes both the tax on what the data center pays plus the tax on any costs passed to ratepayers.</p>
            <ul>
                <li><strong>Price Paid:</strong> $80-140/MWh based on TEP Large General Service rates</li>
                <li><strong>Marginal Cost:</strong> $140-250/MWh - Based on <a href="https://www.lazard.com/media/nltb551p/lazards-lcoeplus-april-2023.pdf" target="_blank" style="color: #60a5fa;">Lazard LCOE Analysis</a> showing:
                    <ul>
                        <li>Solar: $24-96/MWh (unsubsidized)</li>
                        <li>Battery Storage (4-hour): $200-257/MWh (unsubsidized)</li>
                        <li>Gas Peaker: $115-221/MWh</li>
                    </ul>
                </li>
                <li><strong>Calculation Examples:</strong>
                    <ul>
                        <li>Optimistic: 70% solar @ $40/MWh + 20% battery @ $200/MWh + 10% gas @ $150/MWh = $143/MWh</li>
                        <li>Realistic: 50% solar @ $40/MWh + 30% battery @ $220/MWh + 20% gas @ $180/MWh = $182/MWh</li>
                        <li>Conservative: 30% solar @ $40/MWh + 40% battery @ $240/MWh + 30% gas @ $200/MWh = $228/MWh</li>
                    </ul>
                </li>
                <li><strong>Important Note:</strong> These marginal cost estimates exclude network upgrades, transmission costs, permitting costs, and environmental compliance costs</li>
                <li><strong>Tax Rate:</strong> 8.7% combined TPT (5.6% state + 2.6% city + 0.5% county)</li>
            </ul>
           
            <h3>Water Impact Model</h3>
            <p>The water impact uses an "economic value" methodology to capture the true economic value of water, measured in Million Gallons per Day (MGD):</p>
            <p><code>Net Water = (Water Bill √ó 2.6% Tax Rate) - ((Economic Value - Market Price) √ó Annual Usage)</code></p>
            <ul>
                <li><strong>Potable Water Price:</strong> $1,594.30/AF (<a href="https://www.tucsonaz.gov/Departments/Tucson-Water" target="_blank" style="color: #60a5fa;">Tucson Water</a> base industrial rate - excludes summer surcharges)</li>
                <li><strong>Potable Economic Value:</strong> $4,500/AF (economic modeling assumption based on: $800/AF new supply cost + $700/AF opportunity cost + $3,000/AF drought resilience value)</li>
                <li><strong>Tax Rate:</strong> 2.6% (City of Tucson TPT only)</li>
                <li><strong>Water Supply Baseline:</strong> Tucson Water delivered 78.6 MGD of potable water in 2024 (91.6 MGD total including reclaimed)</li>
                <li><strong>Note:</strong> Project Blue claims they will eventually transition to "100% renewable water resources, primarily reclaimed water" via a new 18-mile pipeline on an undisclosed timeline</li>
            </ul>
           
            <h3>Construction vs. Equipment</h3>
            <ul>
                <li><strong>Construction:</strong> Building the facility creates local jobs and procurement. ~48.9% stays in the local economy as wages and materials</li>
                <li><strong>Equipment:</strong> Servers and cooling systems get an 8.7% tax exemption under <a href="https://www.azleg.gov/ars/41/01519.htm" target="_blank" style="color: #60a5fa;">Arizona's Certified Data Center program</a> for 20 years when the project qualifies as a "sustainable redevelopment project" through LEED or similar green building certification</li>
                <li><strong>Note:</strong> Both Google and Meta build their data center campuses to LEED Gold standards or higher, qualifying them for the 20-year exemption period</li>
                <li><strong>Property Tax:</strong> 0.79% effective rate (Tucson median)</li>
            </ul>
           
            <h3>Key Data Sources</h3>
            <ul>
                <li><a href="https://www.tep.com/2023-irp/" target="_blank" style="color: #60a5fa;">TEP 2023 Integrated Resource Plan</a></li>
                <li><a href="https://www.tep.com/2026-rates/" target="_blank" style="color: #60a5fa;">TEP 2026 Rate Case Filing</a></li>
                <li><a href="https://www.tep.com/our-energy-mix/" target="_blank" style="color: #60a5fa;">TEP Energy Mix (9.21 TWh delivered in 2024)</a></li>
                <li><a href="https://tucsononewater.com/wp-content/uploads/2023/10/Tucson-Water-One-Water-2100-Plan_Spreads_Web-Version.pdf" target="_blank" style="color: #60a5fa;">Tucson Water One Water 2100 Plan</a></li>
                <li><a href="https://time.com/5814276/google-data-centers-water/" target="_blank" style="color: #60a5fa;">Google Mesa Campus Water Agreement (1-4 MGD)</a></li>
                <li><a href="https://www.lazard.com/media/nltb551p/lazards-lcoeplus-april-2023.pdf" target="_blank" style="color: #60a5fa;">Lazard LCOE Analysis 2023</a></li>
                <li><a href="https://www.azleg.gov/ars/41/01519.htm" target="_blank" style="color: #60a5fa;">Arizona Rev. Stat. ¬ß 41-1519</a> (Certified Data Center Program)</li>
                <li><a href="https://sustainability.atmeta.com/wp-content/uploads/2024/08/Meta-2024-Sustainability-Report.pdf" target="_blank" style="color: #60a5fa;">Meta 2024 Sustainability Report</a></li>
                <li><a href="https://www.gstatic.com/gumdrop/sustainability/google-2023-environmental-report.pdf" target="_blank" style="color: #60a5fa;">Google 2023 Environmental Report</a></li>
                <li><a href="https://www.azcentral.com/story/money/business/tech/2025/01/31/meta-says-1-billion-data-center-in-mesa-is-sustainable/78031156007/" target="_blank" style="color: #60a5fa;">Meta Mesa Campus (450 MW)</a></li>
            </ul>
           
            <button class="close-button" onclick="hideMethodology()">Close</button>
        </div>
    </div>

    <script>
        // Configuration with real Tucson data
        const CONFIG = {
            // Water comparisons (in MGD - Million Gallons per Day)
            comparisons: {
                water: [
                    { label: "Project Blue's Claim", value: -0.1, type: "developer",
                      tooltip: "Project Blue claims to be 'water positive', meaning it would return more water to the environment than it uses. However, they have not yet selected a specific method or water replenishment project." },
                    { label: "Mesa Google", value: 1, type: "benchmark",
                      tooltip: "Guaranteed allowance at Google's Mesa campus",
                      source: "https://time.com/5814276/google-data-centers-water/" },
                    { label: "Large Campus", value: 4, type: "benchmark",
                      tooltip: "Maximum allowance at Google's Mesa campus",
                      source: "https://time.com/5814276/google-data-centers-water/" }
                ],
                electric: [
                    { label: "Typical", value: 114, type: "benchmark",
                      tooltip: "Typical mature campus usage (1 TWh/yr)",
                      source: "https://sustainability.atmeta.com/wp-content/uploads/2024/08/Meta-2024-Sustainability-Report.pdf" },
                    { label: "Iowa Google", value: 407, type: "benchmark",
                      tooltip: "Google built 407 MW (3.6 TWh/yr) of wind power for its Iowa campus",
                      source: "https://worldstopdatacenters.com/google-council-bluffs-iowa/" },
                    { label: "Mesa Meta", value: 450, type: "benchmark",
                      tooltip: "Meta built 450 MW (3.9 TWh/yr) of solar power for its Mesa campus",
                      source: "https://www.azcentral.com/story/money/business/tech/2025/01/31/meta-says-1-billion-data-center-in-mesa-is-sustainable/78031156007/" }
                ],
                construction: [
                    { label: "Low", value: 1000, type: "benchmark",
                      tooltip: "Small facility construction" },
                    { label: "Project Blue's Claim", value: 1200, type: "developer",
                      tooltip: "Developer claim: $1.2B construction investment" },
                    { label: "Typical", value: 2020, type: "median",
                      tooltip: "Industry typical for 2.25M sq ft" },
                    { label: "High", value: 2500, type: "benchmark",
                      tooltip: "Premium construction" }
                ],
                equipment: [
                    { label: "Min", value: 500, type: "benchmark" },
                    { label: "Typical", value: 1000, type: "median" },
                    { label: "High", value: 2000, type: "benchmark" },
                    { label: "Project Blue's Claim", value: 2400, type: "developer",
                      tooltip: "Developer claim: $2.4B equipment over 3 years" }
                ],
                economic: [
                    { label: "Min", value: 45, type: "benchmark",
                      tooltip: "Contractual minimum: 75 jobs @ $75k. Economic multiplier: 1.4x" },
                    { label: "Project Blue's Claim", value: 60, type: "developer",
                      tooltip: "Developer claim: 180 jobs @ $64k average" },
                    { label: "High", value: 85, type: "benchmark",
                      tooltip: "Best case scenario. Economic multiplier: 2.4x" }
                ],
                electricRate: [
                    { label: "Discounted", value: 90, type: "benchmark",
                      tooltip: "Special economic development rate sometimes offered to attract large users" },
                    { label: "Current", value: 100, type: "median",
                      tooltip: "TEP Large General Service rate for high load factor industrial customers" },
                    { label: "Future", value: 120, type: "benchmark",
                      tooltip: "Potential rate after TEP's proposed 14% increase and future adjustments" }
                ],
                marginalCost: [
                    { label: "Optimistic", value: 143, type: "benchmark",
                      tooltip: "Best case: 70% solar @ $40/MWh + 20% battery @ $200/MWh + 10% gas @ $150/MWh = $143/MWh",
                      source: "Based on Lazard LCOE 2023" },
                    { label: "Realistic", value: 182, type: "median",
                      tooltip: "Expected: 50% solar @ $40/MWh + 30% battery @ $220/MWh + 20% gas @ $180/MWh = $182/MWh",
                      source: "TEP 2023 IRP resource mix for reliability" },
                    { label: "Conservative", value: 228, type: "benchmark",
                      tooltip: "Worst case: 30% solar @ $40/MWh + 40% battery @ $240/MWh + 30% gas @ $200/MWh = $228/MWh",
                      source: "Higher battery/gas needs for 24/7 reliability" }
                ]
            },
           
            // Economic parameters
            rates: {
                electricTax: 0.087,  // 8.7% combined TPT
                waterTax: 0.026,     // 2.6% city only
                waterPricePotable: 1594.30,    // $/AF (base rate, excludes summer surcharges)
                waterEconomicValuePotable: 4500,   // $/AF (analyst assumption)
                propertyTaxRate: 0.0079,    // 0.79% Tucson median
                localCaptureRate: 0.489,    // 48.9% for construction
                cdcTermYears: 20           // Equipment exemption term for sustainable projects
            },
           
            tucsonGDP: 62.2, // billion dollars
            tucsonWaterPotable: 78.6, // MGD potable water delivered in 2024
            tucsonWaterTotal: 91.6, // MGD total including reclaimed
            tepTotal: 9.21  // TWh/year
        };

        let tooltip = document.getElementById('tooltip');
        let tooltipTimeout;

        // Remove loading overlay after content loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loading').classList.add('fade-out');
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 500);
            }, 500);
        });

        // Initialize all hover handlers
        function initializeTooltips() {
            document.querySelectorAll('[data-tooltip]').forEach(element => {
                element.addEventListener('mouseenter', (e) => {
                    showTooltip(e, e.target.dataset.tooltip);
                });
                element.addEventListener('mouseleave', hideTooltip);
            });
        }

        function showTooltip(event, content) {
            clearTimeout(tooltipTimeout);
            tooltip.innerHTML = content;
            tooltip.classList.add('show');
           
            const rect = event.target.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
           
            let x = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            let y = rect.top - tooltipRect.height - 10;
           
            // Keep tooltip on screen
            if (x < 10) x = 10;
            if (x + tooltipRect.width > window.innerWidth - 10) {
                x = window.innerWidth - tooltipRect.width - 10;
            }
            if (y < 10) {
                y = rect.bottom + 10;
            }
           
            tooltip.style.left = x + 'px';
            tooltip.style.top = y + 'px';
        }

        function hideTooltip(event) {
            if (event.relatedTarget && tooltip.contains(event.relatedTarget)) {
                return;
            }
            tooltipTimeout = setTimeout(() => {
                tooltip.classList.remove('show');
            }, 100);
        }

        // Keep tooltip open when hovering over it
        tooltip.addEventListener('mouseenter', () => {
            clearTimeout(tooltipTimeout);
        });

        tooltip.addEventListener('mouseleave', () => {
            tooltip.classList.remove('show');
        });

        function createMarkers(containerId, comparisons, currentValue, range) {
            const container = document.getElementById(containerId);
            if (!container) return;
           
            container.innerHTML = '';
           
            comparisons.forEach(comp => {
                const marker = document.createElement('div');
                marker.className = 'marker' + (comp.type === 'developer' ? ' developer' : '');
                const position = ((comp.value - range.min) / (range.max - range.min)) * 100;
                marker.style.left = position + '%';
               
                const dot = document.createElement('div');
                dot.className = 'marker-dot';
               
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = comp.label;
               
                marker.appendChild(dot);
                marker.appendChild(label);
               
                if (comp.tooltip || comp.source) {
                    marker.addEventListener('mouseenter', (e) => {
                        let tooltipContent = `<strong>${comp.label}</strong><br>${comp.tooltip || ''}`;
                        if (comp.source && comp.source.startsWith('http')) {
                            tooltipContent += `<br><a href="${comp.source}" target="_blank">Source ‚Üó</a>`;
                        } else if (comp.source) {
                            tooltipContent += `<br><em>${comp.source}</em>`;
                        }
                        showTooltip(e, tooltipContent);
                    });
                    marker.addEventListener('mouseleave', hideTooltip);
                }
               
                marker.addEventListener('click', () => {
                    const sliderId = containerId.replace('-markers', '-slider');
                    const slider = document.getElementById(sliderId);
                    if (slider) {
                        // Set value and trigger change
                        slider.value = comp.value;
                        slider.dispatchEvent(new Event('input', { bubbles: true }));
                        updateAll();
                    }
                });
               
                container.appendChild(marker);
            });
        }

        function updateConsumptionBadge(badgeId, percent, type) {
            const badge = document.getElementById(badgeId);
            const absPercent = Math.abs(percent);
            const sign = percent < 0 ? '-' : '';
            badge.textContent = `${sign}${absPercent.toFixed(1)}% of ${type}`;
           
            // Special color logic for water badge
            if (type.includes('Water')) {
                // Clear classes first
                badge.className = 'consumption-badge';
               
                // Green at -1%, transitioning to dark red at 5%
                if (percent <= -1) {
                    badge.style.background = 'rgba(34, 197, 94, 0.2)';
                    badge.style.color = '#22c55e';
                    badge.style.border = '1px solid rgba(34, 197, 94, 0.3)';
                } else if (percent >= 5) {
                    badge.style.background = 'rgba(239, 68, 68, 0.2)';
                    badge.style.color = '#ef4444';
                    badge.style.border = '1px solid rgba(239, 68, 68, 0.3)';
                } else {
                    // Interpolate between green and bright red
                    const t = (percent + 1) / 6; // Normalize -1 to 5 range to 0-1
                    const r = Math.round(34 + (239 - 34) * t);
                    const g = Math.round(197 - (197 - 68) * t);
                    const b = Math.round(94 - (94 - 68) * t);
                    badge.style.background = `rgba(${r}, ${g}, ${b}, 0.2)`;
                    badge.style.color = `rgb(${r}, ${g}, ${b})`;
                    badge.style.border = `1px solid rgba(${r}, ${g}, ${b}, 0.3)`;
                }
            } else {
                // Original logic for electric badge
                // Clear inline styles
                badge.style.background = '';
                badge.style.color = '';
                badge.style.border = '';
               
                badge.className = 'consumption-badge';
                if (absPercent < 5) {
                    badge.className += ' consumption-low';
                } else if (absPercent < 15) {
                    badge.className += ' consumption-medium';
                } else {
                    badge.className += ' consumption-high';
                }
            }
        }

        function updateWater() {
            const mgd = parseFloat(document.getElementById('water-slider').value);
            const afPerYear = mgd / 0.00089; // Convert MGD to AF/yr
            const gallonsPerYear = mgd * 365 * 1000000;
            const households = Math.round(Math.abs(mgd) / 0.000185); // ~185 gal per day per household in Tucson and Oro Valley
            const percent = (mgd / CONFIG.tucsonWaterPotable * 100);
           
            updateConsumptionBadge('water-badge', percent, 'Tucson Potable Water');
           
            // Calculate color for percentage display
            let percentColor = 'var(--text-muted)';
            if (percent <= -1) {
                percentColor = '#22c55e'; // Green
            } else if (percent >= 5) {
                percentColor = '#ef4444'; // Bright red instead of dark red
            } else if (percent > 2) {
                percentColor = 'var(--warning)'; // Orange warning
            }
           
            if (mgd < 0) {
                document.getElementById('water-value').innerHTML = `
                    <div class="value-main" style="color: var(--positive);">-${Math.abs(mgd).toFixed(1)} MGD ("water positive")</div>
                    <div class="value-details">
                        Project Blue claims to be "water positive", meaning it would return more water to the environment than it uses. However, they have not yet selected a specific method or water replenishment project.<br>
                        Equivalent to ${households.toLocaleString()} households worth of water<br>
                        <span style="color: ${percentColor}">
                            ${Math.abs(percent).toFixed(2)}% addition to Tucson's potable water
                        </span>
                    </div>
                `;
            } else {
                document.getElementById('water-value').innerHTML = `
                    <div class="value-main">${mgd.toFixed(1)} MGD of potable water</div>
                    <div class="value-details">
                        Equivalent to ${households.toLocaleString()} households<br>
                        ${(gallonsPerYear/1000000).toFixed(1)} million gallons annually<br>
                        <span style="color: ${percentColor}">
                            ${percent.toFixed(2)}% of Tucson's potable water delivery
                        </span>
                    </div>
                `;
            }
        }

        function updateElectric() {
            const mw = parseFloat(document.getElementById('electric-slider').value);
            const twhPerYear = mw * 0.00876; // Correct formula: MW * 0.00876 = TWh/yr
            const mwhPerYear = twhPerYear * 1000000;
            const households = Math.round(mw * 1000 / 1.1); // ~1.1 kW per household
            const percent = (twhPerYear / CONFIG.tepTotal * 100);
           
            updateConsumptionBadge('electric-badge', percent, 'TEP Supply');
           
            document.getElementById('electric-value').innerHTML = `
                <div class="value-main">${mw} MW continuous load</div>
                <div class="value-details">
                    ${twhPerYear.toFixed(2)} TWh/year (${mwhPerYear.toLocaleString()} MWh)<br>
                    Powers equivalent of ${households.toLocaleString()} households<br>
                    <span style="color: ${percent > 20 ? 'var(--danger)' : percent > 10 ? 'var(--warning)' : 'var(--text-muted)'}">
                        ${percent.toFixed(1)}% of TEP's total generation
                    </span>
                </div>
            `;
        }

        function updateConstruction() {
            const value = parseFloat(document.getElementById('construction-slider').value);
            const localCapture = value * CONFIG.rates.localCaptureRate;
           
            document.getElementById('construction-value').innerHTML = `
                <div class="value-main">$${value.toLocaleString()}M total construction</div>
                <div class="value-details">
                    ~$${localCapture.toFixed(0)}M stays local (48.9% capture rate)<br>
                    Creates ~3,000 construction jobs over 3 years
                </div>
            `;
        }

        function updateEquipment() {
            const value = parseFloat(document.getElementById('equipment-slider').value);
            const annualAbatement = value * CONFIG.rates.electricTax / CONFIG.rates.cdcTermYears;
            const localCapture = value * 0.05; // 5% local capture
           
            document.getElementById('equipment-value').innerHTML = `
                <div class="value-main">$${value.toLocaleString()}M in equipment purchases</div>
                <div class="value-details">
                    Only ~$${localCapture.toFixed(0)}M stays local (5% capture - mostly installation labor)<br>
                    Tax exemption costs Tucson $${annualAbatement.toFixed(1)}M/year for 20 years (LEED certified)
                </div>
            `;
        }

        function updateEconomic() {
            const value = parseFloat(document.getElementById('economic-slider').value);
            const jobs = value < 50 ? 75 : 180;
            const avgSalary = value < 50 ? 75000 : 64000;
            const payroll = jobs * avgSalary / 1000000;
            const localServices = value - payroll;
           
            // Calculate economic multiplier
            const multiplier = 1.4 + (value - 40) / (120 - 40) * (2.4 - 1.4);
            const totalImpact = value * multiplier;
           
            document.getElementById('economic-value').innerHTML = `
                <div class="value-main">$${value}M annual local activity</div>
                <div class="value-details">
                    ~${jobs} jobs @ $${avgSalary.toLocaleString()} = $${payroll.toFixed(1)}M payroll<br>
                    ~$${localServices.toFixed(1)}M in local procurement and services<br>
                    <span style="color: var(--text-muted)">Total economic impact with ${multiplier.toFixed(1)}x multiplier: $${totalImpact.toFixed(1)}M</span>
                </div>
            `;
        }

        function updateRates() {
            const electricRate = parseFloat(document.getElementById('electric-rate-slider').value);
            const marginalCost = parseFloat(document.getElementById('marginal-cost-slider').value);
           
            document.getElementById('electric-rate-value').textContent = `$${electricRate}`;
            document.getElementById('marginal-cost-value').textContent = `$${marginalCost}`;
           
            // Force recalculation when rates change
            calculateNetLocalImpact();
        }

        function calculateNetLocalImpact() {
            // Get inputs
            const waterMGD = parseFloat(document.getElementById('water-slider').value);
            const waterAF = waterMGD / 0.00089; // Convert MGD to AF/yr
            const electricMW = parseFloat(document.getElementById('electric-slider').value);
            const constructionInvestment = parseFloat(document.getElementById('construction-slider').value);
            const equipmentInvestment = parseFloat(document.getElementById('equipment-slider').value);
            const localEconomicActivity = parseFloat(document.getElementById('economic-slider').value);
            const electricRate = parseFloat(document.getElementById('electric-rate-slider').value);
            const marginalCost = parseFloat(document.getElementById('marginal-cost-slider').value);
           
            // Calculate electric impact
            const mwhPerYear = electricMW * 0.00876 * 1000000; // MW * 0.00876 = TWh/yr, then convert to MWh
            const electricBill = mwhPerYear * electricRate;
            const electricTaxRevenue = electricBill * CONFIG.rates.electricTax;
           
            // If marginal cost > rate paid, the difference gets passed to ratepayers who then pay tax on it
            const costPassthrough = Math.max(0, marginalCost - electricRate) * mwhPerYear;
            const taxOnPassthrough = costPassthrough * CONFIG.rates.electricTax;
            const totalElectricTax = electricTaxRevenue + taxOnPassthrough;
           
            const electricSubsidy = costPassthrough; // The subsidy is the cost passed to ratepayers
            const netElectric = totalElectricTax - electricSubsidy;
           
            // Calculate water impact - always use potable water
            const waterPrice = CONFIG.rates.waterPricePotable;
            const waterEconomicValue = CONFIG.rates.waterEconomicValuePotable;
           
            const tucsonWaterPotableAF = CONFIG.tucsonWaterPotable * 365 / 0.00089; // Convert MGD to AF/yr
           
            // Handle negative water (water positive claim)
            let waterTaxRevenue, waterResourceCost, netWater;
            if (waterAF < 0) {
                // Water positive - they claim they'll add water
                waterTaxRevenue = 0; // No tax on water they're not using
                waterResourceCost = Math.abs(waterAF) * waterEconomicValue * -1; // Negative cost = benefit
                netWater = waterTaxRevenue - waterResourceCost;
            } else {
                // Normal water consumption
                const waterBill = waterAF * waterPrice;
                waterTaxRevenue = waterBill * CONFIG.rates.waterTax;
                waterResourceCost = Math.max(0, (waterEconomicValue - waterPrice) * waterAF);
                netWater = waterTaxRevenue - waterResourceCost;
            }
           
            // Calculate fiscal impact
            const annualEquipmentAbatement = equipmentInvestment * 1000000 * CONFIG.rates.electricTax / CONFIG.rates.cdcTermYears;
            const propertyTax = (constructionInvestment + equipmentInvestment) * 1000000 * CONFIG.rates.propertyTaxRate;
            const otherTaxes = localEconomicActivity * 1000000 * 0.02; // ~2% of economic activity as taxes
           
            // Total net impact
            const netAnnual = netElectric + netWater - annualEquipmentAbatement + propertyTax + otherTaxes;
           
            // Construction impact (one-time)
            const constructionBenefit = constructionInvestment * CONFIG.rates.localCaptureRate;
           
            // Update display
            document.getElementById('electric-tax').textContent = '+$' + (totalElectricTax/1000000).toFixed(2) + 'M';
            document.getElementById('electric-tax').setAttribute('data-tooltip',
                costPassthrough > 0 ?
                `Rate: $${electricRate}/MWh √ó ${mwhPerYear.toLocaleString()} MWh √ó 8.7% = $${(electricTaxRevenue/1000000).toFixed(2)}M direct tax + $${(taxOnPassthrough/1000000).toFixed(2)}M tax on passthrough = $${(totalElectricTax/1000000).toFixed(2)}M total` :
                `Rate: $${electricRate}/MWh √ó ${mwhPerYear.toLocaleString()} MWh √ó 8.7% = $${(electricTaxRevenue/1000000).toFixed(2)}M`);
           
            document.getElementById('electric-subsidy').textContent = electricSubsidy > 0 ?
                '-$' + (electricSubsidy/1000000).toFixed(2) + 'M' : '$0';
            document.getElementById('electric-subsidy').setAttribute('data-tooltip',
                electricSubsidy > 0 ?
                `Formula: ($${marginalCost} - $${electricRate})/MWh √ó ${mwhPerYear.toLocaleString()} MWh = $${(electricSubsidy/1000000).toFixed(2)}M. This will appear in future TEP rate cases` :
                'No subsidy when rates cover marginal costs');
           
            document.getElementById('net-electric').textContent =
                (netElectric >= 0 ? '+' : '') + '$' + (netElectric/1000000).toFixed(2) + 'M';
            document.getElementById('net-electric').className = 'cost-value ' +
                (netElectric >= 0 ? 'positive' : 'negative');
           
            // Water display
            if (waterAF < 0) {
                document.getElementById('water-tax').textContent = '$0';
                document.getElementById('water-tax').setAttribute('data-tooltip',
                    'No water tax revenue when project is water positive');
               
                document.getElementById('water-resource').textContent = '+$' + (Math.abs(waterResourceCost)/1000000).toFixed(2) + 'M';
                document.getElementById('water-resource').setAttribute('data-tooltip',
                    `If water is added to system: ${Math.abs(waterAF).toFixed(0)} AF √ó $${waterEconomicValue}/AF = $${(Math.abs(waterResourceCost)/1000000).toFixed(2)}M benefit (Note: Project Blue has not yet selected a specific water replenishment method)`);
                document.getElementById('water-resource').className = 'cost-value positive';
            } else {
                document.getElementById('water-tax').textContent = '+$' + (waterTaxRevenue/1000).toFixed(0) + 'K';
                document.getElementById('water-tax').setAttribute('data-tooltip',
                    `Formula: $${waterPrice.toFixed(0)}/AF √ó ${waterAF.toFixed(0)} AF √ó 2.6% = $${(waterTaxRevenue/1000).toFixed(0)}K`);
               
                document.getElementById('water-resource').textContent = waterResourceCost > 0 ?
                    '-$' + (waterResourceCost/1000000).toFixed(2) + 'M' : '$0';
                document.getElementById('water-resource').setAttribute('data-tooltip',
                    waterResourceCost > 0 ?
                    `Formula: ($${waterEconomicValue} - $${waterPrice.toFixed(0)})/AF √ó ${waterAF.toFixed(0)} AF = $${(waterResourceCost/1000000).toFixed(2)}M` :
                    'No resource cost when price equals economic value');
                document.getElementById('water-resource').className = 'cost-value negative';
            }
           
            document.getElementById('net-water').textContent =
                (netWater >= 0 ? '+' : '') + '$' + (netWater/1000000).toFixed(2) + 'M';
            document.getElementById('net-water').className = 'cost-value ' +
                (netWater >= 0 ? 'positive' : 'negative');
           
            document.getElementById('tax-abatement').textContent = '-$' + (annualEquipmentAbatement/1000000).toFixed(1) + 'M/yr';
            document.getElementById('tax-abatement').setAttribute('data-tooltip',
                `Formula: $${equipmentInvestment}M √ó 8.7% √∑ 20 years = $${(annualEquipmentAbatement/1000000).toFixed(1)}M/yr (LEED certified sustainable redevelopment)`);
           
            document.getElementById('other-taxes').textContent = '+$' + ((propertyTax + otherTaxes)/1000000).toFixed(1) + 'M/yr';
            document.getElementById('other-taxes').setAttribute('data-tooltip',
                `Property tax (0.79% of $${constructionInvestment + equipmentInvestment}M) + other local taxes`);
           
            // Share visualizations
            const waterPercent = (waterMGD / CONFIG.tucsonWaterPotable * 100);
            const electricPercent = ((electricMW * 0.00876) / CONFIG.tepTotal * 100);
           
            // Economic activity as direct spending only (not including tax revenue)
            const economyPercent = (localEconomicActivity / (CONFIG.tucsonGDP * 1000)) * 100;
           
            // Update sticky values at top
            document.getElementById('sticky-water').textContent =
                (waterPercent < 0 ? '-' : '') + Math.abs(waterPercent).toFixed(2) + '%';
            document.getElementById('sticky-electric').textContent = electricPercent.toFixed(2) + '%';
            document.getElementById('sticky-economy').textContent = economyPercent.toFixed(3) + '%';
           
            // Water share - scale to 50% max
            document.getElementById('share-water-percent').textContent =
                (waterPercent < 0 ? '-' : '') + Math.abs(waterPercent).toFixed(2) + '%';
            document.getElementById('share-water-bar').style.width = Math.min(Math.max(Math.abs(waterPercent) * 2, 0.2), 100) + '%';
           
            // Electric share - scale to 50% max
            document.getElementById('share-electric-percent').textContent = electricPercent.toFixed(2) + '%';
            document.getElementById('share-electric-bar').style.width = Math.min(Math.max(electricPercent * 2, 0.2), 100) + '%';
           
            // Economy share - use same scaling as water/electric (2:1)
            document.getElementById('share-economy-percent').textContent = economyPercent.toFixed(3) + '%';
            // Scale: 50% = full bar, so multiply by 2
            const economyBarWidth = economyPercent * 2;
            document.getElementById('share-economy-bar').style.width = Math.max(economyBarWidth, 0.2) + '%';
            document.getElementById('economy-fraction').textContent = '$' + (economyPercent * 10).toFixed(2);
           
            // Net annual impact
            const netAnnualEl = document.getElementById('net-annual');
            netAnnualEl.textContent = (netAnnual >= 0 ? '+' : '') + '$' + (netAnnual/1000000).toFixed(1) + 'M';
            netAnnualEl.className = 'net-annual ' + (netAnnual >= 0 ? 'positive' : 'negative');
            netAnnualEl.setAttribute('data-tooltip',
                `Sum of all annual impacts: Electric + Water + Fiscal = $${(netAnnual/1000000).toFixed(1)}M`);
           
            // Construction impact
            document.getElementById('construction-total').textContent = '+$' + constructionBenefit.toFixed(0) + 'M';
            document.getElementById('construction-total').setAttribute('data-tooltip',
                `Formula: $${constructionInvestment}M √ó 48.9% capture rate = $${constructionBenefit.toFixed(0)}M`);
           
            const constructionGDP = (constructionBenefit / (CONFIG.tucsonGDP * 1000)) * 100;
            document.getElementById('construction-gdp').textContent =
                constructionGDP.toFixed(2) + '% of economy (over 3 years)';
           
            // Reinitialize tooltips for dynamically updated elements
            initializeTooltips();
        }

        function updateAll() {
            updateWater();
            updateElectric();
            updateConstruction();
            updateEquipment();
            updateEconomic();
            // Don't call updateRates here as it causes recursion
            // Just update the display values
            const electricRate = parseFloat(document.getElementById('electric-rate-slider').value);
            const marginalCost = parseFloat(document.getElementById('marginal-cost-slider').value);
            document.getElementById('electric-rate-value').textContent = `$${electricRate}`;
            document.getElementById('marginal-cost-value').textContent = `$${marginalCost}`;
           
            calculateNetLocalImpact();
        }

        function showMethodology() {
            document.getElementById('methodology-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function hideMethodology() {
            document.getElementById('methodology-modal').style.display = 'none';
            document.body.style.overflow = '';
        }

        // Click outside to close modal
        window.onclick = function(event) {
            const modal = document.getElementById('methodology-modal');
            if (event.target == modal) {
                hideMethodology();
            }
        }

        // Initialize
        createMarkers('water-markers', CONFIG.comparisons.water, 1.0, {min: -0.1, max: 5});
        createMarkers('electric-markers', CONFIG.comparisons.electric, 228, {min: 50, max: 500});
        createMarkers('construction-markers', CONFIG.comparisons.construction, 1200, {min: 1000, max: 2500});
        createMarkers('equipment-markers', CONFIG.comparisons.equipment, 2400, {min: 500, max: 2500});
        createMarkers('economic-markers', CONFIG.comparisons.economic, 60, {min: 40, max: 120});
        createMarkers('electric-rate-markers', CONFIG.comparisons.electricRate, 100, {min: 80, max: 140});
        createMarkers('marginal-cost-markers', CONFIG.comparisons.marginalCost, 180, {min: 140, max: 250});

        // Event listeners
        document.getElementById('water-slider').addEventListener('input', updateAll);
        document.getElementById('electric-slider').addEventListener('input', updateAll);
        document.getElementById('construction-slider').addEventListener('input', updateAll);
        document.getElementById('equipment-slider').addEventListener('input', updateAll);
        document.getElementById('economic-slider').addEventListener('input', updateAll);
        document.getElementById('electric-rate-slider').addEventListener('input', updateAll);
        document.getElementById('marginal-cost-slider').addEventListener('input', updateAll);

        // Prevent text selection on sliders
        document.querySelectorAll('.slider-container').forEach(container => {
            container.addEventListener('selectstart', (e) => e.preventDefault());
        });

        // Initial update
        updateAll();
        initializeTooltips();

        // Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideMethodology();
            }
        });

        // Add touch support for mobile
        if ('ontouchstart' in window) {
            document.querySelectorAll('.slider').forEach(slider => {
                slider.addEventListener('touchstart', () => {
                    slider.classList.add('touching');
                });
                slider.addEventListener('touchend', () => {
                    slider.classList.remove('touching');
                });
            });
        }
    </script>
</body>
</html>